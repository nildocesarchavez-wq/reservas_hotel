<div class="w3_navigation">
  <div class="container">
    <nav class="navbar">
      <div class="navbar-header">
        <div class="navbar-left">
          <h1>
            <a class="navbar-brand" routerLink="/">
              New <span>Dawn</span>
              <p class="logo_w3l_agile_caption">Tu resort de ensueño</p>
            </a>
          </h1>
        </div>
        <div class="navbar-right-controls">
          
          <!-- Botón Login (Solo si NO está autenticado) -->
          <a 
            *ngIf="!isAuthenticated && !isLoading" 
            routerLink="/auth/login" 
            class="login-btn login-btn-mobile"
          >
            <i class="fa fa-lock"></i>
            <span>Iniciar Sesión</span>
          </a>

          <!-- Menú de Usuario (Solo si ESTÁ autenticado) -->
          <div *ngIf="isAuthenticated" class="user-menu-container">
            <button 
              type="button" 
              class="user-menu-btn" 
              (click)="toggleUserMenu()"
              [class.active]="userMenuOpen"
            >
              <div class="user-avatar">
                <span>{{ getUserInitials() }}</span>
              </div>
              <span class="user-name-mobile">{{ currentUser?.displayName }}</span>
              <i class="fa fa-chevron-down"></i>
            </button>

            <!-- Dropdown del Usuario -->
            <div class="user-dropdown" [class.show]="userMenuOpen">
              <div class="user-dropdown-header">
                <div class="user-avatar-large">
                  <span>{{ getUserInitials() }}</span>
                </div>
                <div class="user-info">
                  <p class="user-name">{{ currentUser?.displayName }}</p>
                  <p class="user-email">{{ currentUser?.email }}</p>
                  <span class="user-role" [class.admin]="isAdmin">
                    {{ isAdmin ? 'Administrador' : 'Cliente' }}
                  </span>
                </div>
              </div>
              
              <div class="user-dropdown-divider"></div>
              
              <ul class="user-dropdown-menu">
                <li>
                  <button type="button" (click)="goToDashboard()">
                    <i class="fa fa-tachometer"></i>
                    <span>Dashboard</span>
                  </button>
                </li>
                <li>
                  <button type="button" (click)="goToProfile()">
                    <i class="fa fa-user"></i>
                    <span>Mi Perfil</span>
                  </button>
                </li>
                <li *ngIf="!isAdmin">
                  <button type="button" (click)="router.navigate(['/cliente/mis-reservas']); closeUserMenu()">
                    <i class="fa fa-calendar"></i>
                    <span>Mis Reservas</span>
                  </button>
                </li>
              </ul>
              
              <div class="user-dropdown-divider"></div>
              
              <div class="user-dropdown-footer">
                <button type="button" class="logout-btn" (click)="logout()">
                  <i class="fa fa-sign-out"></i>
                  <span>Cerrar Sesión</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoading" class="loading-user">
            <div class="spinner-small"></div>
          </div>

          <!-- Toggle Menu -->
          <button type="button" class="navbar-toggle" id="menuToggle">
            <span class="sr-only">Palanca de navegación</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
      </div>
      
      <div class="navbar-collapse" id="navMenu">
        <nav class="menu menu--iris">
          <ul class="nav navbar-nav menu__list">
            <li class="menu__item menu__item--current">
              <a href="#home" class="menu__link scroll">Casa</a>
            </li>
            <li class="menu__item">
              <a href="#about" class="menu__link scroll">Acerca de</a>
            </li>
            <li class="menu__item">
              <a href="#team" class="menu__link scroll">Equipo</a>
            </li>
            <li class="menu__item">
              <a href="#gallery" class="menu__link scroll">Galería</a>
            </li>
            <li class="menu__item">
              <a href="#rooms" class="menu__link scroll">Habitaciones</a>
            </li>
            <li class="menu__item">
              <a href="#contact" class="menu__link scroll">Contáctenos</a>
            </li>
            
            <!-- Botón Login Desktop (Solo si NO está autenticado) -->
            <li class="menu__item menu__item--login" *ngIf="!isAuthenticated && !isLoading">
              <a routerLink="/auth/login" class="login-btn login-btn-desktop">
                <i class="fa fa-lock"></i>
                <span>Iniciar Sesión</span>
              </a>
            </li>

            <!-- Menú Usuario Desktop (Solo si ESTÁ autenticado) -->
            <li class="menu__item menu__item--user" *ngIf="isAuthenticated">
              <button type="button" class="user-btn-desktop" (click)="toggleUserMenu()">
                <div class="user-avatar-small">
                  <span>{{ getUserInitials() }}</span>
                </div>
                <span>{{ currentUser?.displayName }}</span>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </nav>
  </div>
</div>