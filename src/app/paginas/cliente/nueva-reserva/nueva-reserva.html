<!-- NOTIFICACIÓN FLOTANTE -->
<div class="notification-container" 
     [class.show]="notificacion.visible"
     [class.success]="notificacion.tipo === 'success'"
     [class.error]="notificacion.tipo === 'error'"
     [class.warning]="notificacion.tipo === 'warning'">
  <div class="notification-content">
    <i class="fa" 
       [class.fa-check-circle]="notificacion.tipo === 'success'"
       [class.fa-exclamation-circle]="notificacion.tipo === 'error'"
       [class.fa-exclamation-triangle]="notificacion.tipo === 'warning'"></i>
    <span>{{ notificacion.mensaje }}</span>
    <button class="notification-close" (click)="cerrarNotificacion()">
      <i class="fa fa-times"></i>
    </button>
  </div>
</div>

<!-- MODAL NUEVA RESERVA -->
<div class="modal-overlay" [class.show]="isOpen" (click)="closeModal()">
  <div class="modal-dialog" (click)="$event.stopPropagation()">
    <div class="modal-content">
      
      <!-- MODAL HEADER -->
      <div class="modal-header">
        <h3 class="modal-title">Nueva Reserva</h3>
        <button type="button" class="modal-close" (click)="closeModal()">
          <i class="fa fa-times"></i>
        </button>
      </div>

      <!-- MODAL BODY -->
      <div class="modal-body">
        <form id="reservationForm" (submit)="onSubmit($event)">
          
          <!-- SELECCIÓN DE HABITACIÓN -->
          <div class="form-group">
            <label>Seleccionar Habitación *</label>
            <select 
              class="form-control" 
              [(ngModel)]="reservationData.habitacionId" 
              name="habitacionId"
              (change)="onRoomTypeChange()"
              required>
              <option value="">Seleccionar habitación...</option>
              <option 
                *ngFor="let habitacion of habitacionesDisponibles" 
                [value]="habitacion.id">
                {{ habitacion.numero }} - {{ habitacion.tipo }} - {{ habitacion.precio | solesPeruanos }}/noche ({{ getCapacidadTexto(habitacion.capacidad) }})
              </option>
            </select>
          </div>

          <!-- INFORMACIÓN DE LA HABITACIÓN SELECCIONADA -->
          <div class="room-info" *ngIf="habitacionSeleccionada">
            <div style="background: #f7f9fc; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
              <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem; color: #222b45;">
                <i class="fa fa-info-circle"></i> 
                Información de la Habitación
              </h4>
              <p style="margin: 0.25rem 0; font-size: 0.875rem; color: #8f9bb3;">
                <strong>Tipo:</strong> {{ habitacionSeleccionada.tipo }}
              </p>
              <p style="margin: 0.25rem 0; font-size: 0.875rem; color: #8f9bb3;">
                <strong>Capacidad:</strong> {{ habitacionSeleccionada.capacidad }} {{ habitacionSeleccionada.capacidad === 1 ? 'persona' : 'personas' }}
              </p>
              <p style="margin: 0.25rem 0; font-size: 0.875rem; color: #8f9bb3;">
                <strong>Descripción:</strong> {{ habitacionSeleccionada.descripcion }}
              </p>
              <p style="margin: 0.25rem 0; font-size: 0.875rem; color: #8f9bb3;" *ngIf="habitacionSeleccionada.caracteristicas && habitacionSeleccionada.caracteristicas.length > 0">
                <strong>Características:</strong> {{ habitacionSeleccionada.caracteristicas.join(', ') }}
              </p>
            </div>
          </div>

          <!-- FECHAS -->
          <div class="form-row">
            <div class="form-group">
              <label>Fecha de Check-in *</label>
              <input 
                type="date" 
                class="form-control" 
                [(ngModel)]="reservationData.checkIn" 
                name="checkIn"
                (change)="checkAvailability()"
                [min]="minDate"
                [disabled]="!reservationData.habitacionId"
                required>
            </div>
            <div class="form-group">
              <label>Fecha de Check-out *</label>
              <input 
                type="date" 
                class="form-control" 
                [(ngModel)]="reservationData.checkOut" 
                name="checkOut"
                (change)="checkAvailability()"
                [min]="reservationData.checkIn || minDate"
                [disabled]="!reservationData.habitacionId || !reservationData.checkIn"
                required>
            </div>
          </div>

          <!-- MENSAJE DE DISPONIBILIDAD -->
          <div class="availability-message" *ngIf="availabilityMessage">
            <div 
              class="alert" 
              [ngClass]="{
                'alert-success': isAvailable && !verificandoDisponibilidad, 
                'alert-danger': !isAvailable && !verificandoDisponibilidad,
                'alert-info': verificandoDisponibilidad
              }">
              <i 
                class="fa" 
                [ngClass]="{
                  'fa-check-circle': isAvailable && !verificandoDisponibilidad, 
                  'fa-times-circle': !isAvailable && !verificandoDisponibilidad,
                  'fa-spinner fa-spin': verificandoDisponibilidad
                }">
              </i>
              <span>{{ availabilityMessage }}</span>
            </div>
          </div>

          <!-- RESUMEN DE PRECIO -->
          <div class="booking-summary" *ngIf="totalNights > 0 && isAvailable">
            <h4 style="margin: 0 0 1rem 0; font-size: 1rem; color: #222b45;">
              <i class="fa fa-calculator"></i> Resumen de Precio
            </h4>
            <div class="summary-row">
              <span>Total de noches:</span>
              <strong>{{ totalNights }} {{ totalNights === 1 ? 'noche' : 'noches' }}</strong>
            </div>
            <div class="summary-row">
              <span>Precio por noche:</span>
              <strong>{{ pricePerNight | solesPeruanos }}</strong>
            </div>
            <div class="summary-row total">
              <span>Total estimado:</span>
              <strong>{{ totalPrice | solesPeruanos }}</strong>
            </div>
          </div>

          <!-- NÚMERO DE HUÉSPEDES -->
          <div class="form-group">
            <label>Número de Huéspedes *</label>
            <input 
              type="number" 
              class="form-control" 
              [(ngModel)]="reservationData.guests" 
              name="guests"
              (input)="validarHuespedes($event)"
              (keyup)="validarHuespedes($event)"
              (blur)="validarHuespedes($event)"
              [min]="1"
              [max]="habitacionSeleccionada?.capacidad || 99"
              step="1"
              pattern="[0-9]*"
              maxlength="2"
              required>
            <small style="display: block; margin-top: 0.25rem; color: #8f9bb3; font-size: 0.75rem;" *ngIf="habitacionSeleccionada">
              Máximo: {{ habitacionSeleccionada.capacidad }} {{ habitacionSeleccionada.capacidad === 1 ? 'persona' : 'personas' }}
            </small>
          </div>

          <!-- COMENTARIOS -->
          <div class="form-group">
            <label>Comentarios o Solicitudes Especiales</label>
            <textarea 
              class="form-control" 
              [(ngModel)]="reservationData.comments" 
              name="comments"
              rows="3"
              placeholder="Ej: Necesito cuna para bebé, habitación en piso alto, llegada tarde, etc."></textarea>
          </div>

        </form>
      </div>

      <!-- MODAL FOOTER -->
      <div class="modal-footer">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="closeModal()"
          [disabled]="guardandoReserva">
          Cancelar
        </button>
        <button 
          type="submit" 
          form="reservationForm"
          class="btn btn-primary"
          [disabled]="!isAvailable || !reservationData.checkIn || !reservationData.checkOut || guardandoReserva || verificandoDisponibilidad">
          <i class="fa" [ngClass]="guardandoReserva ? 'fa-spinner fa-spin' : 'fa-check'"></i>
          {{ guardandoReserva ? 'Guardando...' : 'Confirmar Reserva' }}
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Estilos adicionales inline -->
<style>
.alert-info {
    background-color: #e6f3ff;
    color: #0077cc;
    border: 1px solid #0095ff;
}

.room-info {
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Notificación dentro del modal */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10001;
    opacity: 0;
    transform: translateX(400px);
    transition: all 0.3s ease;
}

.notification-container.show {
    opacity: 1;
    transform: translateX(0);
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    min-width: 300px;
    max-width: 500px;
    border-left: 4px solid;
}

.notification-container.success .notification-content {
    border-left-color: #00d68f;
}

.notification-container.success .notification-content i {
    color: #00d68f;
    font-size: 24px;
}

.notification-container.error .notification-content {
    border-left-color: #ff3d71;
}

.notification-container.error .notification-content i {
    color: #ff3d71;
    font-size: 24px;
}

.notification-container.warning .notification-content {
    border-left-color: #ff9500;
}

.notification-container.warning .notification-content i {
    color: #ff9500;
    font-size: 24px;
}

.notification-content span {
    flex: 1;
    font-size: 14px;
    font-weight: 500;
    color: #222b45;
}

.notification-close {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: transparent;
    color: #8f9bb3;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.notification-close:hover {
    background: #f7f9fc;
    color: #222b45;
}
</style>