<div class="app-container">
  <!-- HEADER TOP -->
  <app-header-admin></app-header-admin>

  <!-- SIDEBAR -->
  <app-sidebar-admin></app-sidebar-admin>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="content-wrapper">

      <!-- LOADING INDICATOR -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando información...</p>
      </div>

      <!-- MENSAJES -->
      <div *ngIf="mensajeExito" class="alert alert-success">
        <i class="fa fa-check-circle"></i>
        {{ mensajeExito }}
      </div>

      <div *ngIf="mensajeError" class="alert alert-error">
        <i class="fa fa-exclamation-circle"></i>
        {{ mensajeError }}
      </div>

      <!-- SECCIÓN 1: RESERVAS PENDIENTES -->
      <div *ngIf="!isLoading">
        <div class="page-header">
          <h1 class="page-title">RESERVAS PENDIENTES</h1>
          <p class="page-subtitle">Gestión de solicitudes de reserva de clientes</p>
        </div>

        <div class="content-grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">SOLICITUDES DE RESERVA (NO CONFIRMADAS)</h3>
              <span class="badge badge-warning">{{ reservasPendientes.length }}</span>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Nombre Completo</th>
                      <th>Email</th>
                      <th>Tipo Habitación</th>
                      <th>Entrada</th>
                      <th>Salida</th>
                      <th>Noches</th>
                      <th>Total</th>
                      <th>Estado</th>
                      <th>Acción</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let reserva of reservasPendientes" 
                        [class.selected-row]="reservaSeleccionada?.id === reserva.id">
                      <td>{{ reserva.id.substring(0, 8) }}</td>
                      <td>{{ reserva.usuarioNombre }}</td>
                      <td>{{ reserva.usuarioEmail }}</td>
                      <td>{{ reserva.habitacionTipo }}</td>
                      <td>{{ formatearFecha(reserva.fechaEntrada) }}</td>
                      <td>{{ formatearFecha(reserva.fechaSalida) }}</td>
                      <td>{{ reserva.numeroNoches }}</td>
                      <td>S/. {{ reserva.precioTotal.toFixed(2) }}</td>
                      <td>
                        <span class="status-badge status-pending">
                          {{ obtenerEstadoTexto(reserva.estado) }}
                        </span>
                      </td>
                      <td>
                        <button 
                          class="btn btn-sm btn-info"
                          (click)="seleccionarReserva(reserva)">
                          <i class="fa fa-eye"></i> Ver y Confirmar
                        </button>
                      </td>
                    </tr>
                    <tr *ngIf="reservasPendientes.length === 0">
                      <td colspan="10" class="no-data">
                        <i class="fa fa-inbox"></i>
                        <p>No hay reservas pendientes</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div style="height: 40px;"></div>

        <!-- SECCIÓN 2: DETALLE DE RESERVA -->
        <div *ngIf="reservaSeleccionada" id="reservation-detail">
          <div class="page-header">
            <h1 class="page-title">RESERVA DE HABITACIÓN</h1>
            <p class="page-subtitle" style="color: #666;">
              Detalle de la Reserva ID: {{ reservaSeleccionada.id.substring(0, 8) }}
            </p>
          </div>

          <div class="content-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">

            <!-- Columna Izquierda: Detalles y Confirmación -->
            <div>
              <div class="card card-info">
                <div class="card-header">
                  <h3 class="card-title">CONFIRMACIÓN DE RESERVA</h3>
                </div>
                <div class="card-body">
                  <div class="table-container">
                    <table class="data-table details-table">
                      <tbody>
                        <tr>
                          <th>DESCRIPCIÓN</th>
                          <th>INFORMACIÓN</th>
                        </tr>
                        <tr>
                          <td>ID de Reserva</td>
                          <td>{{ reservaSeleccionada.id }}</td>
                        </tr>
                        <tr>
                          <td>Nombre</td>
                          <td>{{ reservaSeleccionada.usuarioNombre }}</td>
                        </tr>
                        <tr>
                          <td>Email</td>
                          <td>{{ reservaSeleccionada.usuarioEmail }}</td>
                        </tr>
                        <tr>
                          <td>ID Usuario</td>
                          <td>{{ reservaSeleccionada.usuarioId.substring(0, 12) }}...</td>
                        </tr>
                        <tr>
                          <td>Tipo de Habitación</td>
                          <td>{{ reservaSeleccionada.habitacionTipo }}</td>
                        </tr>
                        <tr>
                          <td>No. de Habitación</td>
                          <td>{{ reservaSeleccionada.habitacionNumero }}</td>
                        </tr>
                        <tr>
                          <td>No. de Huéspedes</td>
                          <td>{{ reservaSeleccionada.numeroHuespedes }}</td>
                        </tr>
                        <tr>
                          <td>Tipo de Cama</td>
                          <td>{{ obtenerTipoCama(reservaSeleccionada.habitacionTipo) }}</td>
                        </tr>
                        <tr>
                          <td>Fecha de Entrada</td>
                          <td>{{ formatearFecha(reservaSeleccionada.fechaEntrada) }}</td>
                        </tr>
                        <tr>
                          <td>Fecha de Salida</td>
                          <td>{{ formatearFecha(reservaSeleccionada.fechaSalida) }}</td>
                        </tr>
                        <tr>
                          <td>No. de Noches</td>
                          <td>{{ reservaSeleccionada.numeroNoches }}</td>
                        </tr>
                        <tr>
                          <td>Precio por Noche</td>
                          <td>S/. {{ reservaSeleccionada.precioPorNoche.toFixed(2) }}</td>
                        </tr>
                        <tr>
                          <td>Precio Total</td>
                          <td><strong>S/. {{ reservaSeleccionada.precioTotal.toFixed(2) }}</strong></td>
                        </tr>
                        <tr>
                          <td>Notas / Solicitudes</td>
                          <td>{{ reservaSeleccionada.notas || 'Sin notas especiales' }}</td>
                        </tr>
                        <tr>
                          <td>Estado Actual</td>
                          <td>
                            <span class="status-badge" [ngClass]="{
                              'status-pending': reservaSeleccionada.estado === 'pendiente',
                              'status-confirmed': reservaSeleccionada.estado === 'confirmada'
                            }">
                              {{ obtenerEstadoTexto(reservaSeleccionada.estado) }}
                            </span>
                          </td>
                        </tr>
                        <tr>
                          <td>Fecha de Creación</td>
                          <td>{{ formatearFecha(reservaSeleccionada.createdAt) }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="card-footer">
                  <form class="form" (ngSubmit)="confirmarReserva()">
                    <div class="form-group">
                      <label for="confirmation">Seleccione la Acción</label>
                      <select 
                        name="conf" 
                        id="confirmation" 
                        class="form-input"
                        [(ngModel)]="estadoConfirmacion"
                        style="max-width: 250px;">
                        <option value="pendiente">Seleccionar...</option>
                        <option value="confirmada">✓ Confirmar Reserva</option>
                        <option value="cancelada">✗ Cancelar Reserva</option>
                      </select>
                    </div>
                    <button 
                      type="submit" 
                      class="btn"
                      [ngClass]="{
                        'btn-success': estadoConfirmacion === 'confirmada',
                        'btn-danger': estadoConfirmacion === 'cancelada'
                      }"
                      [disabled]="estadoConfirmacion === 'pendiente'">
                      <i class="fa" [ngClass]="{
                        'fa-check': estadoConfirmacion === 'confirmada',
                        'fa-times': estadoConfirmacion === 'cancelada'
                      }"></i>
                      {{ estadoConfirmacion === 'confirmada' ? 'Confirmar' : 
                         estadoConfirmacion === 'cancelada' ? 'Cancelar' : 
                         'Seleccione una acción' }}
                    </button>
                  </form>
                </div>
              </div>
            </div>

            <!-- Columna Derecha: Disponibilidad -->
            <div>
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">DISPONIBILIDAD EN TIEMPO REAL</h3>
                </div>
                <div class="card-body">
                  <table class="data-table availability-table">
                    <tbody>
                      <tr *ngFor="let disponibilidad of disponibilidadHabitaciones">
                        <td><b>{{ disponibilidad.tipo }}</b></td>
                        <td>
                          <span class="badge" [ngClass]="{
                            'badge-primary': disponibilidad.cantidad > 0,
                            'badge-danger': disponibilidad.cantidad === 0
                          }">
                            {{ disponibilidad.cantidad > 0 ? disponibilidad.cantidad : 'NO' }}
                          </span>
                        </td>
                      </tr>
                      <tr *ngIf="disponibilidadHabitaciones.length === 0">
                        <td colspan="2" class="no-data-small">
                          <p>Sin habitaciones disponibles</p>
                        </td>
                      </tr>
                      <tr style="border-top: 2px solid #ccc;">
                        <td><b>Total de Habitaciones Libres</b></td>
                        <td>
                          <span class="badge badge-success">
                            {{ totalHabitacionesLibres }}
                          </span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Estadísticas adicionales -->
              <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                  <h3 class="card-title">RESUMEN</h3>
                </div>
                <div class="card-body">
                  <div class="stats-grid">
                    <div class="stat-item">
                      <div class="stat-label">Total Reservas</div>
                      <div class="stat-value">{{ todasReservas.length }}</div>
                    </div>
                    <div class="stat-item">
                      <div class="stat-label">Pendientes</div>
                      <div class="stat-value text-warning">{{ reservasPendientes.length }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </main>
</div>